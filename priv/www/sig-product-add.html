<!--  vim: set ts=3:  -->
<link rel="import" href="polymer/polymer.html">
<link rel="import" href="i18n-msg/i18n-msg.html">
<link rel="import" href="i18n-msg/i18n-msg-behavior.html">
<link rel="import" href="iron-ajax/iron-ajax.html">
<link rel="import" href="iron-collapse/iron-collapse.html">
<link rel="import" href="paper-dialog/paper-dialog.html">
<link rel="import" href="paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="paper-listbox/paper-listbox.html">
<link rel="import" href="paper-toolbar/paper-toolbar.html">
<link rel="import" href="paper-input/paper-input.html">
<link rel="import" href="paper-button/paper-button.html">
<link rel="import" href="paper-tooltip/paper-tooltip.html">
<link rel="import" href="paper-toggle-button/paper-toggle-button.html" >
<link rel="import" href="paper-toast/paper-toast.html">
<link rel="import" href="paper-styles/color.html">
<link rel="import" href="paper-date-picker/paper-date-picker.html">

<dom-module id="sig-product-add">
	<template>
		<style is="custom-style">
			paper-dialog {
				overflow: auto;
			}
			paper-item {
				padding-right: 10px;
			}
			paper-toolbar{
				margin-top: 0px;
				color: white;
				background-color: #bc5100;
			}
			paper-toast.error {
				background-color: var(--paper-red-a400);
			}
			.add-button {
				background-color: var(--paper-lime-a700);
				color: black;
				width: 8em;
			}
			.cancel-button {
				color: black;
			}
			.close {
				background-color: var(--paper-lime-a700);
				color: black;
				float: right;
				width: 5em;
			}
		</style>
		<paper-dialog id="addProductModal" modal>
			<paper-toolbar>
				<paper-tabs selected="{{selected}}">
					<paper-tab id="offer-add">
						<h2>[[i18n.offer]]</h2>
					</paper-tab>
					<paper-tab id="price-add">
						<h2>[[i18n.prices]]</h2>
					</paper-tab>
					<paper-tab id="alt-add">
						<h2>[[i18n.alter]]</h2>
					</paper-tab>
				</paper-tabs>
			</paper-toolbar>
			<iron-pages selected="{{selected}}">
				<div id="addOff-tab">
					<div>
						<paper-input id="addOffName"
								class="name"
								name="name"
								label="[[i18n.name]]"
								onfocus="addProductEndDatePickOff.hide(); addProductStartDatePickOff.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="offerNameTool">
								Product Offering name
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addOffDesc"
								class="description"
								name="description"
								label="[[i18n.des]]"
								onfocus="addProductEndDatePickOff.hide(); addProductStartDatePickOff.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="offerDesTool">
								Product Offering description
							</i18n-msg>
						</paper-tooltip>
					</div>
<!--
					<div>
						<paper-dropdown-menu
								label="[[i18n.productSpec]]">
							<paper-listbox
									id="addOffProductSpecification"
									slot="dropdown-content"
									class="dropdown-content">
								<template is="dom-repeat" items="[[productSpec]]">
									<paper-item>
										{{item.sName}}
									</paper-item>
								</template>
							</paper-listbox>
						</paper-dropdown-menu>
					</div>
-->
					<div>
						<iron-collapse id="addProductStartDatePickOff">
							<paper-date-picker id="startOff3" date="{{addProductStartDateOfferPick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addOffStart"
								value="[[addProductStartDateOffer]]"
								name="addProductStartDateOffer"
								label="[[i18n.start]]"
								onfocus="addProductEndDatePickOff.hide(); addProductStartDatePickOff.show();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="offerStartTool">
								Product Offering start date
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductEndDatePickOff">
							<paper-date-picker id="endOff3" date="{{addProductEndDateOfferPick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addOffEnd"
								value="[[addProductEndDateOffer]]"
								name="addProductEndDateOffer"
								label="[[i18n.end]]"
								onfocus="addProductStartDatePickOff.hide(); addProductEndDatePickOff.show();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="offerEndTool">
								Product Offering end date
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div class="buttons">
						<paper-button
								raised
								class="add-button"
								on-tap="addOffer">
								<i18n-msg msgid="submit">
									Submit
								</i18n-msg>
						</paper-button>
						<paper-button
								dialog-dismiss
								class="cancel-button"
								on-tap="cancelDialog">
								<i18n-msg msgid="cancel">
									cancel
								</i18n-msg>
						</paper-button>
					</div>
				</div>
				<div id=addPrice-tab>
					<div>
						<datalist id="price">
							<template is="dom-repeat" items="[[prices]]">
								<option value="{{item.name}}" />
							</template>
						</datalist>
						<paper-input id="addPriceName"
								list="price"
								label="[[i18n.name]]"
								on-value-changed="addUpdatePriceDialog"
								onclick="addPriceName.value=null"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="addPriceNameTool">
								Product offering price name
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addPriceDesc"
								class="description"
								name="description"
								label="[[i18n.des]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceDesTool">
								Product Offering price description
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductStartDatePickPrice">
							<paper-date-picker id="addPriceStart" date="{{addProductStartDatePricePick}}" headingFormat="dd, MMM D">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addPriceStartDate"
								value="[[addProductStartDatePrice]]"
								name="addProductStartDatePrice"
								label="[[i18n.start]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.show();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceStartTool">
								Product Offering price start date
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductEndDatePickPrice">
							<paper-date-picker id="addPriceEnd" date="{{addProductEndDatePricePick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addPriceEndDate"
								value="[[addProductEndDatePrice]]"
								name="addProductEndDatePrice"
								label="[[i18n.end]]"
								onfocus="addProductStartDatePickPrice.hide(); addProductEndDatePickPrice.show();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceEndTool">
								Product offering price end date
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu id="addPriceTypedrop"
								label="[[i18n.priceType]]"
								on-selected-item-changed="checkRecure"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
							<paper-listbox
									id="addPriceType"
									slot="dropdown-content"
									class="dropdown-content">
								<paper-item>
									Recurring
								</paper-item>
								<paper-item>
									One Time
								</paper-item>
								<paper-item>
									Usage
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
							<i18n-msg msgid="priceTypeTool">
								Product offering type of price
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addPriceSize"
								class="size"
								name="size"
								type="text"
								allowed-pattern="[0-9kmg]"
								pattern="^[0-9]+[kmg]?$"
								label="[[i18n.unitSize]]"
								auto-validate
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceSizeTool">
								Product offering price unit size
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu id="addPriceUnitsdrop"
								label="[[i18n.unit]]"
								on-selected-item-changed="checkPattern"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
							<paper-listbox
									id="addPriceUnits"
									slot="dropdown-content"
									class="dropdown-content">
								<paper-item id="priceBytes">
									 <i18n-msg msgid="octet">
										bytes
									</i18n-msg>
								</paper-item>
								<paper-item id="priceCents">
									<i18n-msg msgid="cent">
										cents
									</i18n-msg>
								</paper-item>
								<paper-item id="priceSeconds">
									<i18n-msg msgid="second">
										seconds
									 </i18n-msg>
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
							<i18n-msg msgid="priceUnitTool">
								Product offering price units
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addPriceAmount"
								class="amount"
								name="amount"
								type="number"
								label="[[i18n.amount]]"
								value=0
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceAmountTool">
								Product offering price amount
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addPriceCurrency"
								class="currency"
								name="currency"
								label="[[i18n.currency]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
						</paper-input>
						<paper-tooltip>
							<i18n-msg msgid="priceCurrencyTool">
								Product offering price currency
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu id="addPricePerioddrop"
								label="[[i18n.period]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
							<paper-listbox
									id="addPricePeriod"
									slot="dropdown-content"
									class="dropdown-content"
									selected="2">
								<paper-item>
									Daily
								</paper-item>
								<paper-item>
									Weekly
								</paper-item>
								<paper-item>
									Monthly
								</paper-item>
								<paper-item>
									Yearly
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
							<i18n-msg msgid="pricePeriodTool">
								Product offering price period
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu
								id="addPriceDrop"
								label="[[i18n.alter]]"
								onfocus="addProductEndDatePickPrice.hide(); addProductStartDatePickPrice.hide();">
							<paper-listbox
									id="addPriceAlteration"
									slot="dropdown-content"
									class="dropdown-content">
									<template is="dom-repeat" items="[[alterations]]">
										<paper-item>
											{{item.name}}
										</paper-item>
									</template>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
							<i18n-msg msgid="priceAlterTool">
								add alteration to product offering price
							</i18n-msg>
						</paper-tooltip>
					</div>
					<div class="buttons">
						<paper-button
								raised
								class="add-button"
								on-tap="addPrice">
								<i18n-msg msgid="[[addOrUpdateButton]]">
									[[addOrUpdateButton]]
								</i18n-msg>
						</paper-button>
						<paper-button
								dialog-dismiss
								class="cancel-button"
								on-tap="cancelDialog">
								<i18n-msg msgid="cancel">
									cancel
								</i18n-msg>
						</paper-button>
					</div>
				</div>
				<div id="add-Alt-tab">
					<div>
						<datalist id="alts">
							<template is="dom-repeat" items="[[alterations]]">
								<option value="{{item.name}}" />
							</template>
						</datalist>
						<paper-input id="addAltName"
								list="alts"
								label="[[i18n.name]]"
								onclick="addAltName.value=null"
								on-value-changed="updateAltsDialog">
						</paper-input>
						<paper-tooltip>
								product offering alteration name
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addAltDesc"
								class="description"
								name="description"
								label="[[i18n.des]]"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
						</paper-input>
						<paper-tooltip>
								product offering alteration description
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductStartDatePickAlt">
							<paper-date-picker id="startAlt3" date="{{addProductStartDateAltPick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addAltStartDate"
								value="[[addProductStartDateAlt]]"
								name="addProductStartDateAlt"
								label="[[i18n.start]]"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.show();">
						</paper-input>
						<paper-tooltip>
								product offering alteration start date
						</paper-tooltip>
					</div>
					<div>
						<iron-collapse id="addProductEndDatePickAlt">
							<paper-date-picker id="endAlt3" date="{{addProductEndDateAltPick}}">
							</paper-date-picker>
						</iron-collapse>
						<paper-input id="addAltEndDate"
								value="[[addProductEndDateAlt]]"
								name="addProductEndDateAlt"
								label="[[i18n.end]]"
								onfocus="addProductStartDatePickAlt.hide(); addProductEndDatePickAlt.show();">
						</paper-input>
						<paper-tooltip>
								product offering alteration end date
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu
								label="[[i18n.priceType]]"
								on-selected-item-changed="checkRecureAlt"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
							<paper-listbox
									id="addAltType"
									slot="dropdown-content"
									class="dropdown-content">
								<paper-item>
									Recurring
								</paper-item>
								<paper-item>
									One Time
								</paper-item>
								<paper-item>
									Usage
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
								product offering alteration price type
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addAltSize"
								class="size"
								name="size"
								label="[[i18n.unitSize]]"
								type="text"
								allowed-pattern="[0-9kmg]"
								pattern="^[0-9]+[kmg]?$"
								auto-validate
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
						</paper-input>
						<paper-tooltip>
								product offering alteration size
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu
								label="[[i18n.unit]]">
							<paper-listbox
									id="addAltUnitDrop"
									on-selected-item-changed="checkPatternAlt"
									slot="dropdown-content"
									class="dropdown-content">
									<paper-item id="altBytes">
										<i18n-msg msgid="octet">
											bytes
										</i18n-msg>
									</paper-item>
									<paper-item id="altCents">
										<i18n-msg msgid="cent">
											cents
										</i18n-msg>
									</paper-item>
									<paper-item id="altSeconds">
										<i18n-msg msgid="second">
											seconds
										</i18n-msg>
									</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
								product offering alteration units
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addAltAmount"
								class="amount"
								name="amount"
								label="[[i18n.amount]]"
								type="number"
								value=0
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
						</paper-input>
						<paper-tooltip>
								product offering alteration amount
						</paper-tooltip>
					</div>
					<div>
						<paper-input id="addAltCurrency"
								class="currency"
								name="currency"
								label="[[i18n.currency]]"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
						</paper-input>
						<paper-tooltip>
								product offering alteration currency
						</paper-tooltip>
					</div>
					<div>
						<paper-dropdown-menu id="addalt5drop"
								label="[[i18n.period]]"
								onfocus="addProductEndDatePickAlt.hide(); addProductStartDatePickAlt.hide();">
							<paper-listbox
									id="addAltPeriod"
									slot="dropdown-content"
									class="dropdown-content">
								<paper-item>
									Daily
								</paper-item>
								<paper-item>
									Weekly
								</paper-item>
								<paper-item>
									Monthly
								</paper-item>
								<paper-item>
									Yearly
								</paper-item>
							</paper-listbox>
						</paper-dropdown-menu>
						<paper-tooltip>
								product offering alteration period
						</paper-tooltip>
					</div>
					<div class="buttons">
						<paper-button
								raised
								class="add-button"
								on-tap="addAlteration">
								<i18n-msg msgid="[[addOrUpdateButton]]">
									[[addOrUpdateButton]]
								<i18n-msg>
						</paper-button>
						<paper-button
								dialog-dismiss
								class="cancel-button"
								on-tap="cancelDialog">
								<i18n-msg msgid="cancel">
									cancel
								</i18n-msg>
						</paper-button>
					</div>
				</div>
			</iron-pages>
			<paper-toast
					id="addProductToastError">
			</paper-toast>
		</paper-dialog>
		<iron-ajax
				id="addProductAjax"
				url="/catalogManagement/v2/productOffering"
				method = "POST"
				content-type="application/json"
				on-loading-changed="_onLoadingChanged"
				on-response="_addProductResponse"
				on-error="_addProductError">
		</iron-ajax>
		<iron-ajax
			id="getProductSpecificationAjax"
			url="/catalogManagement/v2/productSpecification"
			method="GET"
			on-response="_getProductSpecificationResponse"
			on-error="_getProductSpecificationError">
		</iron-ajax>
	</template>
	<script>
		Polymer ({
			is: 'sig-product-add',
			behaviors: [i18nMsgBehavior],
			properties: {
				alterations: {
					type: Array,
					value: function() {
						return [];
					}
				},
				prices: {
					type: Array,
					value: function() {
						return [];
					}
				},
				productSpec: {
					type: Array,
					value: function() {
						return [];
					}
				},
				selected: {
					type: Number,
					value: 0
				},
				addProductStartDateOffer: {
					type: String,
					value: ""
				},
				addProductEndDateOffer: {
					type: String,
					value: ""
				},
				addProductStartDatePrice: {
					type: String,
					value: ""
				},
				addProductEndDatePrice: {
					type: String,
					value: ""
				},
				addProductStartDateAlt: {
					type: String,
					value: ""
				},
				addProductEndDateAlt: {
					type: String,
					value: ""
				},
				addProductStartDateOfferPick: {
					observer: '_addProductStartDateOfferPick'
				},
				addProductEndDateOfferPick: {
					observer: '_addProductEndDateOfferPick'
				},
				addProductStartDatePricePick: {
					observer: '_addProductStartDatePricePick'
				},
				addProductEndDatePricePick: {
					observer: '_addProductEndDatePricePick'
				},
				addProductStartDateAltPick: {
					observer: '_addProductStartDateAltPick'
				},
				addProductEndDateAltPick: {
					observer: '_addProductEndDateAltPick'
				},
				addOrUpdateButton: {
					type: String,
					value: "add"
				}
			},
			_addProductStartDateOfferPick: function(date) {
				if (this.$.addProductStartDatePickOff.opened) {
					this.addProductStartDateOffer = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductEndDateOfferPick: function(date) {
				if (this.$.addProductEndDatePickOff.opened) {
					this.addProductEndDateOffer = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductStartDatePricePick: function(date) {
				if (this.$.addProductStartDatePickPrice.opened) {
					this.addProductStartDatePrice = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductEndDatePricePick: function(date) {
				if (this.$.addProductEndDatePickPrice.opened) {
					this.addProductEndDatePrice = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductStartDateAltPick: function(date) {
				if (this.$.addProductStartDatePickAlt.opened) {
					this.addProductStartDateAlt = moment(date).format('YYYY-MM-DD');
				}
			},
			_addProductEndDateAltPick: function(date) {
				if (this.$.addProductEndDatePickAlt.opened) {
					this.addProductEndDateAlt = moment(date).format('YYYY-MM-DD');
				}
			},
			_getProductSpecificationResponse: function(event) {
				var results = event.detail.xhr.response;
				for (var index in results) {
					function checkExist(spec) {
						return spec.name == results[index].name;
					}
					if(!this.productSpec.some(checkExist)){
						var newSpec = new Object();
						newSpec.id = results[index].id;
						newSpec.href = results[index].href;
						newSpec.name = results[index].name;
						newSpec.sName = newSpec.name.replace("ProductSpec", "");
						this.push('productSpec', newSpec);
					}
				}
			},
			_getProductSpecificationError: function(event) {
				this.$.addProductToastError.text = event.detail.request.xhr.statusText;
				this.$.addProductToastError.open();
			},
			addUpdatePriceDialog: function() {
				function checkPriceUpdateName(price) {
					return price.name == document.getElementById("addPriceName").value;
				}
				if(this.prices != undefined) {
					var indexPrice = this.prices.findIndex(checkPriceUpdateName);
					if (indexPrice == -1) {
						this.addOrUpdateButton = "add";
						this.$.addPriceDesc.value = null;
						this.$.addPriceStartDate.value = null;
						this.$.addPriceEndDate.value = null;
						this.$.addPriceType.selected = null;
						this.$.addPriceSize.value = null;
						this.$.addPriceUnits.selected = null;
						this.$.addPriceAmount.value = null;
						this.$.addPriceCurrency.value = null;
						this.$.addPricePeriod.selected = null;
						this.$.addPriceAlteration.selected = null;
					} else {
						this.addOrUpdateButton = "update";
						this.$.addPriceDesc.value = this.prices[indexPrice].description;
						this.$.addPriceStartDate.value = this.prices[indexPrice].start;
						this.$.addPriceEndDate.value = this.prices[indexPrice].end;
						switch(this.prices[indexPrice].type) {
							case "recurring":
								this.$.addPriceType.selected = 0;
								break;
							case "one_time":
								this.$.addPriceType.selected = 1;
								break;
							case "usage":
								this.$.addPriceType.selected = 2;
								break;
						}
						this.$.addPriceSize.value = this.prices[indexPrice].size;
						switch(this.prices[indexPrice].unit) {
							case "b":
								this.$.addPriceUnits.selected = 0;
								break;
							case "c":
								this.$.addPriceUnits.selected = 1;
								break;
							case "s":
								this.$.addPriceUnits.selected = 2;
								break;
						}
						this.$.addPriceCurrency.value = this.prices[indexPrice].currency;
						this.$.addPriceAmount.value = this.prices[indexPrice].amount;
						switch(this.prices[indexPrice].period) {
							case "daily":
								this.$.addPricePeriod.selected = 0;
								break;
							case "weekly":
								this.$.addPricePeriod.selected = 1;
								break;
							case "monthly":
								this.$.addPricePeriod.selected = 2;
								break;
							case "yearly":
								this.$.addPricePeriod.selected = 3;
								break;
						}
						if(this.prices[indexPrice].alterations &&
								this.prices[indexPrice].alterations.name) {
							var altPriceNew = this.prices[indexPrice].alterations.name;
							function checkAltName(alt) {
								return alt.name == altPriceNew;
							}
							this.$.addPriceAlteration.selected = this.alterations.findIndex(checkAltName);
						}
					}
				}
			},
			updateAltsDialog: function() {
				function checkName(alts) {
					return alts.name == document.getElementById("addAltName").value;
				}
				if(this.alterations != undefined) {
					var index = this.alterations.findIndex(checkName);
					if (index == -1) {
						this.addOrUpdateButton = "add";
						this.$.addAltDesc.value = null;
						this.$.addAltStartDate.value = null;
						this.$.addAltEndDate.value = null;
						this.$.addAltType.selected = null;
						this.$.addAltSize.value = null;
						this.$.addAltUnitDrop.selected = null;
						this.$.addAltAmount.value = null;
						this.$.addAltCurrency.value = null;
						this.$.addAltPeriod.selected = null;
					} else {
						this.addOrUpdateButton = "update";
						this.$.addAltDesc.value = this.alterations[index].description;
						this.$.addAltStartDate.value = this.alterations[index].startdate;
						this.$.addAltEndDate.value = this.alterations[index].terminationDate;
						switch(this.alterations[index].type) {
							case "recurring":
								this.$.addAltType.selected = 0;
								break;
							case "one_time":
								this.$.addAltType.selected = 1;
								break;
							case "usage":
								this.$.addAltType.selected = 2;
								break;
						}
						this.$.addAltSize.value = this.alterations[index].size;
						switch(this.alterations[index].unit) {
							case "b":
								this.$.addAltUnitDrop.selected = 0;
								break;
							case "c":
								this.$.addAltUnitDrop.selected = 1;
								break;
							case "s":
								this.$.addAltUnitDrop.selected = 2;
								break;
						}
						this.$.addAltCurrency.value = this.alterations[index].currency;
						this.$.addAltAmount.value = this.alterations[index].amount;
						switch(this.alterations[index].period) {
							case "daily":
								this.$.addAltPeriod.selected = 0;
								break;
							case "weekly":
								this.$.addAltPeriod.selected = 1;
								break;
							case "monthly":
								this.$.addAltPeriod.selected = 2;
								break;
							case "yearly":
								this.$.addAltPeriod.selected = 3;
								break;
						}
					}
				}
			},
			addOffer: function() {
				var offerNew = new Object();
				if(this.$.addOffName.value) {
					offerNew.name = this.$.addOffName.value;
				}
				if(this.$.addOffDesc.value) {
					offerNew.description = this.$.addOffDesc.value;
				}
//				var specIndex = this.$.addOffProductSpecification.selected;
//				if(specIndex) {
//					offerNew.productSpecification = this.productSpec[specIndex];
//					delete offerNew.productSpecification.sName;
//				}
				var startDateTime;
				var endDateTime;
				if(this.$.addOffStart.value) {
					startDateTime = this.$.addOffStart.value;
				}
				if(this.$.addOffEnd.value) {
					endDateTime = this.$.addOffEnd.value;
				}
				if(startDateTime && endDateTime) {
					offerNew.validFor = {startDateTime, endDateTime};
				} else if(startDateTime && !endDateTime) {
					offerNew.validFor = {startDateTime};
				} else if(!startDateTime && endDateTime) {
					offerNew.validFor = {endDateTime};
				}
				function mapPrice(item) {
					var out = new Object();
					if(item.name) {
						out.name = item.name;
					}
					if(item.description) {
						out.description = item.description;
					}
					var startDateTime;
					var endDateTime;
					if(item.start) {
						startDateTime = item.start;
					}
					if(item.end) {
						endDateTime = item.end;
					}
					if(startDateTime && endDateTime) {
						out.validFor = {startDateTime, endDateTime};
					} else if(startDateTime && !endDateTime) {
						out.validFor = {startDateTime};
					} else if(!startDateTime  && endDateTime) {
						out.validFor = {endDateTime};
					}
					if(item.type) {
						out.priceType = item.type;
					}
					if(item.unit && item.size) {
						var len = item.size.length;
						var m = item.size.charAt(len - 1);
						var s = item.size.slice(0, (len - 1));
						if(item.unit == "b") {
							if (m == "m") {
								out.unitOfMeasure = s + "000000b";
							} else if(m == "g") {
								out.unitOfMeasure = s + "000000000b";
							} else if(m == "k") {
								out.unitOfMeasure = s + "000b";
							} else {
								out.unitOfMeasure = item.size;
							}
						} else if(item.unit == "c"){
							out.unitOfMeasure = item.amount + "c";
						} else if(item.unit == "s") {
							var n = Number(s);
							if(m == "m") {
								n = n * 60;
								out.unitOfMeasure = n.toString();
							} else if(m == "h") {
								n = n * 3600;
								out.unitOfMeasure = n.toString();
							} else {
								out.unitOfMeasure = item.size;
							}
						}
					}
					var taxIncludedAmount;
					var currencyCode;
					if(item.amount) {
						taxIncludedAmount = item.amount;
					}
					if(item.currency) {
						currencyCode = item.currency;
					}
					if(item.amount && item.currency) {
						out.price = {taxIncludedAmount, currencyCode};
					} else if (item.amount && !item.currency) {
						out.price = {taxIncludedAmount};
					} else if (!item.amount && item.currency) {
						out.price = {currencyCode};
					}
					if(item.period) {
						out.recurringChargePeriod = item.period;
					}
					if(item.alterations) {
						out.productOfferPriceAlteration = new Object();
						if(item.alterations.name) {
							out.productOfferPriceAlteration.name = item.alterations.name;
						}
						if (item.alterations.description) {
							out.productOfferPriceAlteration.description = item.alterations.description;
						}
						var startDateTime;
						var endDateTime;
						if (item.alterations.startdate) {
							startDateTime = item.alterations.startdate;
						}
						if (item.alterations.terminationDate) {
							endDateTime = item.alterations.terminationDate;
						}
						if (startDateTime && endDateTime) {
							out.productOfferPriceAlteration.validFor = {startDateTime, endDateTime}
						} else if(startDateTime && !endDateTime) {
							out.productOfferPriceAlteration.validFor = {startDateTime};
						} else if(!startDateTime && endDateTime) {
							out.productOfferPriceAlteration.validFor = {endDateTime};
						}
						if (item.alterations.type) {
							out.productOfferPriceAlteration.priceType = item.alterations.type;
						}
						if (item.alterations.unit && item.alterations.size) {
							var len1 = item.alterations.size.length;
							var m1 = item.alterations.size.charAt(len - 1);
							var s1 = item.alterations.size.slice(0, (len - 1));
							if(item.alterations.unit == "b") {
								if (m1 == "m") {
									out.productOfferPriceAlteration.unitOfMeasure = s1 + "000000b";
								} else if(m1 == "g") {
									out.productOfferPriceAlteration.unitOfMeasure = s1 + "000000000b";
								} else if(m1 == "k") {
									out.productOfferPriceAlteration.unitOfMeasure = s1 + "000b";
								} else {
									out.productOfferPriceAlteration.unitOfMeasure = item.alterations.size;
								}
							} else if(item.alterations.unit == "c"){
								out.productOfferPriceAlteration.unitOfMeasure = item.alterations.amount + "c";
							} else if(item.alterations.unit == "s") {
								var n1 = Number(s1);
								if(m1 == "m") {
									n1 = n1 * 60;
									out.productOfferPriceAlteration.unitOfMeasure = n1.toString();
								} else if(m1 == "h") {
									n1 = n1 * 3600;
									out.productOfferPriceAlteration.unitOfMeasure = n1.toString();
								} else {
									out.productOfferPriceAlterationunitOfMeasure = item.alterations.size;
								}
							}
						}
						var taxIncludedAmount;
						var currencyCode
						if (item.alterations.amount || item.alterations.amount == 0) {
							taxIncludedAmount = item.alterations.amount;
						}
						if (item.alterations.currency) {
							currencyCode = item.alterations.currency;
						}
						if((taxIncludedAmount >= 0) && currencyCode) {
							out.productOfferPriceAlteration.price = {taxIncludedAmount, currencyCode};
						} else if ((taxIncludedAmount >= 0) && !currencyCode) {
							out.productOfferPriceAlteration.price = {taxIncludedAmount};
						} else if (!(taxIncludedAmount >= 0) && currencyCode) {
							out.productOfferPriceAlteration.price = {currencyCode};
						}
						if (item.alterations.period) {
							out.productOfferPriceAlteration.recurringChargePeriod = item.alterations.period;
						}
					}
					return out;
				}
				offerNew.productOfferingPrice = this.prices.map(mapPrice);
				if(offerNew.name
						&& offerNew.productOfferingPrice.length > 0) {
					var ajax = this.$.addProductAjax;
					ajax.body = offerNew;
					ajax.generateRequest();
				} else {
					this.$.addProductToastError.text = "Validation failed";
					this.$.addProductToastError.open();
				}
			},
			checkPattern: function() {
				if(this.$.addPriceUnits.selected == 0) {
					this.$.addPriceSize.allowedPattern = "[0-9kmg]";
					this.$.addPriceSize.pattern = "^[0-9]+[kmg]?$";
					this.$.addPriceSize.disabled = false;
				} else if(this.$.addPriceUnits.selected == 1) {
					this.$.addPriceSize.allowedPattern = "[0-9]";
					this.$.addPriceSize.pattern = "^[0-9]+$";
					this.$.addPriceSize.disabled = true;
				} else if(this.$.addPriceUnits.selected == 2) {
					this.$.addPriceSize.allowedPattern = "[0-9mh]";
					this.$.addPriceSize.pattern = "^[0-9]+[mh]?$";
					this.$.addPriceSize.disabled = false;
				}
			},
			checkPatternAlt: function() {
				if(this.$.addAltUnitDrop.selected == 0) {
					this.$.addAltSize.allowedPattern = "[0-9kmg]";
					this.$.addAltSize.pattern = "^[0-9]+[kmg]?$";
					this.$.addAltSize.disabled= false;
				} else if(this.$.addAltUnitDrop.selected == 1) {
					this.$.addAltSize.allowedPattern = "[0-9]";
					this.$.addAltSize.pattern = "^[0-9]+$";
					this.$.addAltSize.disabled= true;
				} else if(this.$.addAltUnitDrop.selected == 2) {
					this.$.addAltSize.allowedPattern = "[0-9mh]";
					this.$.addAltSize.pattern = "^[0-9]+[mh]?$";
					this.$.addAltSize.disabled = false;
				}
			},
			checkRecure: function() {
				if(this.$.addPriceType.selected == 0) {
					this.$.addPricePerioddrop.disabled = false;
					this.$.priceBytes.disabled = true;
					this.$.priceSeconds.disabled = true;
					this.$.priceCents.disabled = false;
					this.$.addPriceUnits.selected = 1;
				} else if(this.$.addPriceType.selected == 1) {
					this.$.addPricePerioddrop.disabled = true;
					this.$.priceBytes.disabled = true;
					this.$.priceSeconds.disabled = true;
					this.$.priceCents.disabled = false;
					this.$.addPriceUnits.selected = 1;
				} else if(this.$.addPriceType.selected == 2) {
					this.$.addPricePerioddrop.disabled = true;
					this.$.priceCents.disabled = true;
					this.$.priceBytes.disabled = false;
					this.$.priceSeconds.disabled = false;
					this.$.addPriceUnits.selected = 0;
				}
			},
			checkRecureAlt: function() {
				if(this.$.addAltType.selected == 0) {
					this.$.addalt5drop.disabled = false;
					this.$.altBytes.disabled = false;
					this.$.altSeconds.disabled = false;
					this.$.altCents.disabled = false;
					this.$.addAltUnitDrop.selected = 1;
				} else if(this.$.addAltType.selected == 1) {
					this.$.addalt5drop.disabled = true;
					this.$.altBytes.disabled = false;
					this.$.altSeconds.disabled = false;
					this.$.altCents.disabled = false;
					this.$.addAltUnitDrop.selected = 1;
				} else if(this.$.addAltType.selected == 2) {
					this.$.addalt5drop.disabled = true;
					this.$.altBytes.disabled = false;
					this.$.altSeconds.disabled = false;
					this.$.altCents.disabled = true;
				}
			},
			addPrice: function(event) {
				function checkPriceName(price) {
					return price.name == document.getElementById("addPriceName").value;
				}
				var indexPrice = this.prices.findIndex(checkPriceName);
				if (indexPrice == -1) {
					var priceNew = new Object();
				} else {
					var priceNew = this.prices[indexPrice];
				}
				priceNew.name = this.$.addPriceName.value;
				priceNew.description = this.$.addPriceDesc.value;
				priceNew.start = this.$.addPriceStartDate.value;
				priceNew.end = this.$.addPriceEndDate.value;
				switch(this.$.addPriceType.selected) {
					case 0:
						priceNew.type = "recurring";
						break;
					case 1:
						priceNew.type = "one_time";
						break;
					case 2:
						priceNew.type = "usage";
				}
				switch(this.$.addPriceUnits.selected) {
					case 0:
						priceNew.unit = "b";
						break;
					case 1:
						priceNew.unit = "c";
						break;
					case 2:
						priceNew.unit = "s";
				}
				priceNew.amount = parseInt(this.$.addPriceAmount.value);
				priceNew.size = this.$.addPriceSize.value;
				priceNew.currency = this.$.addPriceCurrency.value;
				switch(this.$.addPricePeriod.selected) {
					case 0:
						priceNew.period = "daily";
						break;
					case 1:
						priceNew.period = "weekly";
						break;
					case 2:
						priceNew.period = "monthly";
						break
					case 3:
						priceNew.period = "yearly";
				}
				if(this.$.addPriceDrop.value) {
					function checkAlt(alts) {
						return alts.name == document.getElementById("addPriceDrop").value;
					}
					var altIndex = this.alterations.findIndex(checkAlt);
					priceNew.alterations = this.alterations[altIndex];
				}
				function checkExistType(price) {
					if(priceNew.type == "usage") {
						return price.type == priceNew.type;
					}
				}
				if(priceNew.name
						&& priceNew.type
						&& !this.prices.some(checkExistType)
						&& priceNew.unit
						&& (priceNew.size || priceNew.unit== "c")
						&& priceNew.amount) {
					if (indexPrice == -1) {
						this.push('prices', priceNew);
					} else {
						this.splice('prices', indexPrice, 1, priceNew);
						this.addOrUpdateButton = "add";
					}
					this.$.addPriceName.value = null;
					this.$.addPriceDesc.value = null;
					this.$.addPriceStartDate.value = null;
					this.$.addPriceEndDate.value = null;
					this.$.addPriceType.selected = null;
					this.$.addPriceSize.value = null;
					this.$.addPriceUnits.selected = null;
					this.$.addPriceAmount.value = null;
					this.$.addPriceCurrency.value = null;
					this.$.addPricePeriod.selected = null;
					this.$.addPriceAlteration.selected = null;
					document.getElementById("addProductToastSuccess").open();
				} else {
					this.$.addProductToastError.text = "Validation failed";
					this.$.addProductToastError.open();
				}
			},
			addAlteration: function() {
				function checkAltName(alt) {
					return alt.name == document.getElementById("addAltName").value;
				}
				var indexAlt = this.alterations.findIndex(checkAltName);
				if (indexAlt == -1) {
					var altNew = new Object();
				} else {
					var altNew = this.prices[indexAlt];
				}
				var altNew = new Object();
				altNew.name = this.$.addAltName.value;
				altNew.description = this.$.addAltDesc.value;
				altNew.startdate = this.$.addAltStartDate.value;
				altNew.terminationDate = this.$.addAltEndDate.value;
				switch(this.$.addAltType.selected) {
					case 0:
						altNew.type = "recurring";
						break;
					case 1:
						altNew.type = "one_time";
						break;
					case 2:
						altNew.type = "usage";
				}
				altNew.size = this.$.addAltSize.value;
				altNew.amount= parseInt(this.$.addAltAmount.value);
				altNew.currency = this.$.addAltCurrency.value;
				switch(this.$.addAltPeriod.selected) {
					case 0:
						altNew.period = "daily";
						break;
					case 1:
						altNew.period = "weekly";
						break;
					case 2:
						altNew.period = "monthly";
						break
					case 3:
						altNew.period = "yearly";
				}
				switch(this.$.addAltUnitDrop.selected) {
					case 0:
						altNew.unit = "b";
						break;
					case 1:
						altNew.unit = "c";
						break
					case 2:
						altNew.unit = "s";
						break
				}
				if(altNew.name
						&& altNew.type
						&& altNew.unit
						&& (altNew.size || altNew.unit == "c")
						&& (altNew.amount || altNew.amount == 0)) {
					if (indexAlt == -1) {
						this.push('alterations', altNew);
					} else {
						this.splice('alterations', indexAlt, 1, altNew);
						this.addOrUpdateButton = "add";
					}
					this.$.addAltName.value = null
					this.$.addAltDesc.value = null;
					this.$.addAltStartDate.value = null;
					this.$.addAltEndDate.value = null;
					this.$.addAltType.selected = null;
					this.$.addAltSize.value = null;
					this.$.addAltUnitDrop.selected = null;
					this.$.addAltAmount.value = null;
					this.$.addAltCurrency.value = null;
					this.$.addAltPeriod.selected = null;
					document.getElementById("addProductToastSuccess").open();
				} else {
					this.$.addProductToastError.text = "Validation failed";
					this.$.addProductToastError.open();
				}
			},
			_onLoadingChanged: function(event) {
				if (this.$.addProductAjax.loading) {
					document.getElementById("progress").disabled = false;
				} else {
					document.getElementById("progress").disabled = true;
				}
			},
			_addProductResponse: function(event) {
				this.$.addProductModal.close();
				document.getElementById("addProductToastSuccess").open();
				this.$.addOffName.value = null;
				this.$.addOffDesc.value = null;
				this.set('prices', []);
				this.set('alterations', []);
				document.getElementById("productGrid").clearCache();
			},
			_addProductError: function(event) {
				this.$.addProductToastError.text = event.detail.request.xhr.statusText;
				this.$.addProductToastError.open();
			},
			cancelDialog: function() {
				this.set('prices', []);
				this.set('alterations', []);
				this.set('productSpec', []);
				this.addOrUpdateButton = "add";
				this.$.addOffName.value = null;
				this.$.addOffDesc.value = null;
//				this.$.addOffProductSpecification.selected = null;
				this.$.addOffStart.value = null;
				this.$.addOffEnd.value = null;
				this.$.addProductStartDatePickOff.hide()
				this.$.addProductEndDatePickOff.hide()
				this.$.addProductStartDatePickPrice.hide();
				this.$.addProductEndDatePickPrice.hide();
				this.$.addProductStartDatePickAlt.hide();
				this.$.addProductEndDatePickAlt.hide();
				this.$.addPriceName.value = null;
				this.$.addPriceDesc.value = null;
				this.$.addPriceStartDate.value = null;
				this.$.addPriceEndDate.value = null;
				this.$.addPriceType.selected = null;
				this.$.addPriceSize.value = null;
				this.$.addPriceUnits.selected = null;
				this.$.addPriceAmount.value = null;
				this.$.addPriceCurrency.value = null;
				this.$.addPricePeriod.selected = null;
				this.$.addAltName.value = null
				this.$.addAltDesc.value = null;
				this.$.addAltStartDate.value = null;
				this.$.addAltEndDate.value = null;
				this.$.addAltType.selected = null;
				this.$.addAltSize.value = null;
				this.$.addAltUnitDrop.selected = null;
				this.$.addAltAmount.value = null;
				this.$.addAltCurrency.value = null;
				this.$.addAltPeriod.selected = null;
				this.$.addProductModal.close();
			}
		});
	</script>
</dom-module>
